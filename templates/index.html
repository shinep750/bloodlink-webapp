{% extends 'base.html' %}

{% block content %}
<div class="page-header">
    <h1>Dashboard</h1>
    <!-- Quick Actions for Staff -->
   
</div>

<!-- Main Dashboard Layout Grid -->
<div class="dashboard-layout">

    <!-- Main Content Area (Left) -->
    <div class="main-content">
        <!-- Urgent Alerts -->
        {% if critical_shortages %}
        <div class="alert-container alert-danger">
            <div class="alert-icon"><i class="fa-solid fa-triangle-exclamation"></i></div>
            <div class="alert-content">
                <h3>Urgent Shortage Alert!</h3>
                <p>Critically low stock (less than 3 units): <strong>{{ critical_shortages|join(', ') }}</strong>.</p>
            </div>
        </div>
        {% endif %}

        <!-- Quick Stats -->
        <div class="stat-grid">
            <div class="stat-card">
                <div class="stat-card-info">
                    <h3>{{ stats.total_donors }}</h3>
                    <p>Total Donors</p>
                </div>
                <div class="stat-card-icon"><i class="fa-solid fa-users"></i></div>
            </div>
            <div class="stat-card">
                <div class="stat-card-info">
                    <h3>{{ stats.available_bags }}</h3>
                    <p>Available Bags</p>
                </div>
                <div class="stat-card-icon"><i class="fa-solid fa-syringe"></i></div>
            </div>
            <div class="stat-card">
                <div class="stat-card-info">
                    <h3>{{ stats.total_transfusions }}</h3>
                    <p>Total Transfusions</p>
                </div>
                <div class="stat-card-icon"><i class="fa-solid fa-heart-pulse"></i></div>
            </div>
        </div>

        <!-- Inventory Overview Chart -->


        
    <!-- Sidebar (Right) -->
    <div class="sidebar">
        <!-- WHO Notifications Widget -->
        <div class="widget-card">
            <h3><i class="fa-solid fa-bell"></i> Health Notifications</h3>
            <ul class="notification-list">
                {% for notification in notifications %}
                <li>
                    <p>{{ notification.content }}</p>
                    <span class="source">{{ notification.source }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Latest News Widget -->
        <div class="widget-card">
            <h3><i class="fa-solid fa-newspaper"></i> Latest News</h3>
            <ul class="news-list">
                 {% for article in news_articles %}
                <li>
                    <p>{{ article.title }}</p>
                    <span class="source">{{ article.source }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const inventoryData = {{ inventory_chart_data|tojson|safe }};
    const donutCtx = document.getElementById('inventoryDonutChart');

    if (donutCtx && inventoryData.length > 0) {
        new Chart(donutCtx, {
            type: 'doughnut',
            data: {
                labels: inventoryData.map(item => item.blood_group),
                datasets: [{
                    label: 'Available Bags',
                    data: inventoryData.map(item => item.count),
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 206, 86, 0.7)',
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(153, 102, 255, 0.7)',
                        'rgba(255, 159, 64, 0.7)',
                        'rgba(201, 203, 207, 0.7)',
                        'rgba(255, 99, 71, 0.7)'
                    ],
                    borderColor: 'rgba(255, 255, 255, 0.2)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: 'white'
                        }
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}

